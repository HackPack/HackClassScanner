#! /usr/bin/env hhvm
<?hh
if(substr(php_sapi_name(), 0, 3) !== 'cli'){
    http_response_code(404);
    die();
}

// Find the composer autoloader
$thisdir = __DIR__;

do {
    if(file_exists($thisdir . '/autoload.php')) {
        require_once($thisdir . '/autoload.php');
        break;
    }
    if(file_exists($thisdir . '/vendor/autoload.php')) {
        require_once($thisdir . '/vendor/autoload.php');
        break;
    }
    $thisdir = dirname($thisdir);
    if($thisdir === '/'){
        die('You need to set up the project dependencies using the following commands:' . PHP_EOL .
            'curl -s http://getcomposer.org/installer | php' . PHP_EOL .
            'php composer.phar install' . PHP_EOL);
    }
} while(true);

if($argc !== 2 || ! is_dir($argv[1])) {
    die('scan <path to scan route>');
}

use kilahm\Scanner\ClassScanner;

ClassScanner::fromCli($argv)->mapFileToClass();
